---
title: 'Datasetin lokaldan S3-É™ yÃ¼klÉ™nmÉ™si, Amazon Athena ilÉ™ sorÄŸulanmasÄ± vÉ™ formatÄ±nÄ±n dÉ™yiÅŸdirilmÉ™si'
date: '2023-01-12'
tags: []
draft: false
summary: 'Bu mÉ™qalÉ™dÉ™ lokalda olan dataseti aws cli istifadÉ™ edÉ™rÉ™k S3 bucketinÉ™ yÃ¼klÉ™nmÉ™sini vÉ™ Ã¼zÉ™rindÉ™ sadÉ™ SQL sorÄŸularÄ±nÄ± yazmaÄŸÄ± Ã¶yrÉ™nÉ™cÉ™yik.'
images: ['/static/blogs/aws-localdan-s3e-yukleme/aws-s3e-yukleme.png']
authors: ['default']
---

Amazon S3 ilÉ™ baÄŸlÄ± xÃ¼susi mÉ™qalÉ™min olacaÄŸÄ±nÄ± dÃ¼ÅŸÃ¼nÃ¼rÉ™m, lakin Ã¼mumi olaraq S3 verilÉ™nlÉ™rin yÃ¼ksÉ™k É™lÃ§atanlÄ±q vÉ™ davamlÄ±lÄ±qla saxlanÄ±lmasÄ±nÄ± tÉ™klif edir. Biz S3-dÉ™ olan mÉ™lumatlarÄ± baÅŸqa bir yerÉ™ kÃ¶Ã§Ã¼rmÉ™dÉ™n Athena interaktiv sorÄŸu xidmÉ™ti vasitÉ™si ilÉ™ sadÉ™ SQL sorÄŸularÄ± icra edÉ™cÉ™yik.

Ä°lk addÄ±mda csv fayl formatÄ±nda olan dataset Ã¼zÉ™rindÉ™ sorÄŸular yazacaq, daha sonra isÉ™ csv mÉ™lumatlarÄ±nÄ± sorÄŸulamaq Ã¼Ã§Ã¼n optimallaÅŸdÄ±rÄ±lmÄ±ÅŸ, sÃ¼tunlu fayl formatÄ± Apache Parket-É™ necÉ™ asanlÄ±qla Ã§evirÉ™cÉ™yimizi gÃ¶stÉ™rÉ™cÉ™yik.

Bu tutorialda sizÉ™ AWS hesabÄ± ehtiyac olacaq vÉ™ istifadÉ™ olunacaq servislÉ™r aws free tier-É™ daxildir. ÆtraflÄ± mÉ™lumat vÉ™ qeydiyyatdan keÃ§mÉ™k Ã¼Ã§Ã¼n bu mÉ™qalÉ™ni  [oxuya bilÉ™rsi](https://aws.amazon.com/free/?all-free-tier.sort-by=item.additionalFields.SortRank&all-free-tier.sort-order=asc&awsf.Free%20Tier%20Types=*all&awsf.Free%20Tier%20Categories=*all)niz

## AddÄ±m 1 â€” Datasetin kompÃ¼terÉ™ yÃ¼klÉ™nmÉ™si

MÉ™qalÉ™dÉ™ 2019-cu ildÉ™ hazÄ±rladÄ±ÄŸÄ±m supermarket datasetini istifadÉ™ edÉ™cÉ™yik. DatasetdÉ™ supermarketin 20 filialÄ±nda 80 000 mÃ¼ÅŸtÉ™rinin aldÄ±ÄŸÄ± 438 826 AzÉ™rbaycan mÉ™hsulu ilÉ™ baÄŸlÄ± mÉ™lumatlar toplanÄ±b. ([É™traflÄ± mÉ™lumat](https://www.academia.edu/42561999/Data_Analitikas%C4%B1_tap%C5%9F%C4%B1r%C4%B1qlar%C4%B1)) Dataseti bu linkdÉ™n istifadÉ™ edÉ™rÉ™k, kompÃ¼terinizÉ™  [yÃ¼klÉ™yin](https://www.kaggle.com/datasets/nicatheynal/supermarketdataset?resource=download).

Datasetin Ã¼mumi tÉ™sviri bu ÅŸÉ™kildÉ™dir.

![](https://miro.medium.com/max/875/1*ilTDEGq1Ja7jKlzC_nay9w.png)

## AddÄ±m 2 â€” AWS CLI ilÉ™ datasetin S3-É™ yÃ¼klÉ™nmÉ™si

AWS CLI â€” Command Line Interface (AWS CLI) AWS xidmÉ™tlÉ™rinizi idarÉ™ etmÉ™k Ã¼Ã§Ã¼n vahid Ã¼suldur. Komandalar vasitÉ™si ilÉ™ siz bir neÃ§É™ AWS xidmÉ™tlÉ™rini konfiqurasiya edÉ™, idarÉ™ edÉ™ vÉ™ onlarÄ± skriptlÉ™r vasitÉ™silÉ™ avtomatlaÅŸdÄ±ra bilÉ™rsiniz.

Ola bilÉ™r ki, bizim hazÄ±rda istifadÉ™ etdiyimiz istifadÉ™Ã§inin S3-É™ full icazÉ™si yoxdur. CLI-dÉ™n istifadÉ™ edÉ™rÉ™k AWS-É™ daxil olarkÉ™n, iÅŸlÉ™mÉ™k niyyÉ™tindÉ™ olduÄŸunuz resurslara kifayÉ™t qÉ™dÉ™r icazÉ™si olan bir vÉ™ ya daha Ã§ox IAM istifadÉ™Ã§isi yaratmalÄ±yÄ±q. Bu sÉ™bÉ™bdÉ™n iÅŸÉ™ yeni IAM istifadÉ™Ã§i yaratmaqla baÅŸlayacaÄŸÄ±q.

Amazon S3-É™ Ã§Ä±xÄ±ÅŸÄ± olan IAM istifadÉ™Ã§isi yaratmaq Ã¼Ã§Ã¼n É™vvÉ™lcÉ™ [AWS IAM konsolunuza](https://console.aws.amazon.com/iam)  daxil olmalÄ±sÄ±nÄ±z.  **Access management**  qrupunun altÄ±nda  **Users**  Ã¼zÉ™rinÉ™ kliklÉ™yin. Daha sonra,  **Add user** Ã¼zÉ™rinÉ™ kliklÉ™yin.

![](https://miro.medium.com/max/875/1*5dhsIbdRM1xvZ9-7wyVuVg.png)

ArdÄ±nca,  **User name*** qutusuna s3Admin kimi yaratdÄ±ÄŸÄ±nÄ±z IAM istifadÉ™Ã§isinin adÄ±nÄ± yazÄ±n.  **Access type*** seÃ§imindÉ™  **Programmatic access** seÃ§in. Sonra isÉ™  **Next: Permissions** dÃ¼ymÉ™sini kliklÉ™yin.

![](https://miro.medium.com/max/875/1*U21lpDUoCiz8CNTxRYVzUg.png)

AÃ§Ä±lan nÃ¶vbÉ™ti sÉ™hifÉ™dÉ™,  **Attach existing policies directly**  Ã¼zÉ™rinÉ™ kliklÉ™yin. Sonra, AmazonS3FullAccess siyasÉ™t adÄ±nÄ± axtarÄ±n vÉ™ onu seÃ§in. BitirdikdÉ™n sonra Next: Tags Ã¼zÉ™rinÉ™ kliklÉ™yin.

![](https://miro.medium.com/max/875/1*GaVOgv8SerKL-FQpaEgbZg.png)

Bundan sonra gÉ™lÉ™n sÉ™hifÉ™dÉ™ heÃ§nÉ™yi dÉ™yiÅŸdirmÉ™yÉ™rÉ™k, nexti seÃ§in vÉ™ É™n sonda create user Ã¼zÉ™rinÉ™ kliklÉ™yin.

![](https://miro.medium.com/max/875/1*rEUZhZ7DHfYkpRz-K5Iaxg.png)

NÉ™hayÉ™t, istifadÉ™Ã§i yaradÄ±ldÄ±qdan sonra siz GiriÅŸ aÃ§arÄ± ID-sini vÉ™ Gizli giriÅŸ aÃ§arÄ± kopyalayÄ±b sonrakÄ± istifadÉ™ Ã¼Ã§Ã¼n saxlamalÄ±sÄ±nÄ±z. Biz hÉ™mÃ§inin birazdan AWS CLI Ã¼Ã§Ã¼n dÉ™ bu dÉ™yÉ™rlÉ™ri istifadÉ™ edÉ™cÉ™yik.

**NÉ™zÉ™rÉ™ alÄ±n ki, bu dÉ™yÉ™rlÉ™ri yalnÄ±z bir dÉ™fÉ™ gÃ¶rmÉ™ ÅŸansÄ±nÄ±z var.**

KompÃ¼terinizdÉ™ AWS profilinin qurulmasÄ±

Amazon S3-É™ mÃ¼vafiq icazÉ™si olan IAM istifadÉ™Ã§isini yaratdÄ±ÄŸÄ±mÄ±z Ã¼Ã§Ã¼n nÃ¶vbÉ™ti addÄ±m kompÃ¼terimizdÉ™ AWS CLI profilini qurmaqdÄ±r. Bu addÄ±m Ã¼Ã§Ã¼n AWS CLI v2 alÉ™tini quraÅŸdÄ±rmalÄ±sÄ±nÄ±z.  [QuraÅŸdÄ±rmaq Ã¼Ã§Ã¼n linki izlÉ™yÉ™ bilÉ™rsiniz](https://docs.aws.amazon.com/cli/latest/userguide/getting-started-install.html#cliv2-windows-install).

Profil yaratmaq Ã¼Ã§Ã¼n sizÉ™ aÅŸaÄŸÄ±dakÄ± mÉ™lumatlar lazÄ±mdÄ±r:

IAM istifadÉ™Ã§isinin GiriÅŸ aÃ§arÄ± ID-si. â€”  **Access key ID**

IAM istifadÉ™Ã§isi ilÉ™ É™laqÉ™li gizli giriÅŸ aÃ§arÄ±. â€”  **Secret access key**

Defolt bÃ¶lgÉ™ adÄ± â€” AWS S3 bucketinizin yerlÉ™ÅŸdiyi regiona uyÄŸundur. Bu mÉ™qalÉ™dÉ™ AWS S3 bucketi US East (N. Virginia)-da yerlÉ™ÅŸir vÉ™ endpointimiz us-east-1 dir.

Standart Ã§Ä±xÄ±ÅŸ formatÄ±. Bunun Ã¼Ã§Ã¼n  **JSON**  istifadÉ™ edin.

Profil yaratmaq Ã¼Ã§Ã¼n cmd vÉ™ ya terminalÄ± aÃ§Ä±b, aÅŸaÄŸÄ±dakÄ± komandanÄ± daxil edin. Daha sonra isÉ™ yuxarÄ±da qeyd olunduÄŸu ardÄ±cÄ±llÄ±qla mÉ™lumatlarÄ± daxil edin. Access key id vÉ™ secret access key olaraq bayaq gÃ¶rmÃ¼ÅŸ olduÄŸumuz yeni yaradÄ±lmÄ±ÅŸ istifadÉ™Ã§i Ã¼Ã§Ã¼n olan dÉ™yÉ™rlÉ™ri daxil edin.

aws configure

![](https://miro.medium.com/max/875/1*N2QQ8QGiUomtj8Hn7bAVHA.png)

AWS CLI profilini konfiqurasiya etdikdÉ™n sonra terminalda aÅŸaÄŸÄ±dakÄ± É™mri iÅŸlÉ™tmÉ™klÉ™ profilin iÅŸlÉ™diyini tÉ™sdiqlÉ™yÉ™ bilÉ™rsiniz. Bu É™mr indiyÉ™ qÉ™dÉ™r yaratmÄ±ÅŸ olduÄŸumuz s3 bucketlÉ™rin siyahÄ±sÄ±nÄ± bizÉ™ qaytaracaq.

aws s3 ls

Bura qÉ™dÉ™r problemsiz gÉ™ldiksÉ™, É™la! ğŸ‰

NÃ¶vbÉ™ti addÄ±m isÉ™ faylÄ±mÄ±zÄ± yÃ¼klÉ™mÉ™k Ã¼Ã§Ã¼n yeni bir s3 bucketi yaratmaq olacaq. Bunun Ã¼Ã§Ã¼n elÉ™ hÉ™min terminalda  **aws s3 mb s3://bucketin adÄ±** É™mrini yazÄ±n. DiqqÉ™t edin ki, yaratmÄ±ÅŸ olduÄŸunuz bucket adÄ± global olaraq unikaldÄ±r, yÉ™ni mÉ™nim aÅŸaÄŸÄ±da yaratmÄ±ÅŸ olduÄŸum adda sizin bucketiniz ola bilmÉ™z.

![](https://miro.medium.com/max/875/1*e1A29XB6kfDNQlb-mUfu3g.png)

aws s3 ls É™mrini tÉ™krarlayaraq bucketin hÉ™qiqÉ™tÉ™n yarandÄ±ÄŸÄ±nÄ± gÃ¶rÉ™ bilÉ™rsiniz.

Bayaq yÃ¼klÉ™diyimiz supermarket dataseti hansÄ± qovluqdadÄ±r? Bu bizÉ™ lazÄ±mdÄ±r, Ã§Ã¼nki faylÄ± S3-É™ yÃ¼klÉ™mÉ™k Ã¼Ã§Ã¼n aws s3 cp É™mrinÉ™ iki arqument (mÉ™nbÉ™ vÉ™ hÉ™dÉ™f) tÉ™qdim etmÉ™liyik.

MÉ™nbÉ™: faylÄ±n bizim komputerimizdÉ™ki Ã¼nvanÄ±

HÉ™dÉ™f: faylÄ± yÃ¼klÉ™mÉ™k istÉ™diyimiz bucketin Ã¼nvanÄ±

FaylÄ±n komputerdÉ™ yerlÉ™ÅŸdiyi Ã¼nvanÄ± kopyalayÄ±n vÉ™ terminalda aÅŸaÄŸÄ±dakÄ± É™mri Ã¶z vÉ™ziyyÉ™tiniz Ã¼Ã§Ã¼n dÉ™yiÅŸdirÉ™rÉ™k yazÄ±n.

aws s3 cp /Users/nijatzeynalov/Downloads/esas_mehsullar.csv s3://ssupermarket-dataset

ls É™mrindÉ™n istifadÉ™ edÉ™rÉ™k, faylÄ±n hÉ™qiqÉ™tÉ™n bucketimizÉ™ yÃ¼klÉ™nmiÅŸ olduÄŸunu tÉ™sdiqlÉ™yÉ™ bilÉ™rik.

![](https://miro.medium.com/max/875/1*qOTAeUGCAsg5C65rBDIW_A.png)

## AddÄ±m 3 â€” Amazon Athena ilÉ™ dataset Ã¼zÉ™rindÉ™ SQL sorÄŸularÄ±nÄ±n yazÄ±lmasÄ±

Amazon Athena standart SQL istifadÉ™ edÉ™rÉ™k Amazon S3-dÉ™ olan verilÉ™nlÉ™ri tÉ™hlil etmÉ™yi asanlaÅŸdÄ±ran interaktiv sorÄŸu xidmÉ™tidir. Athena ilÉ™ biz S3-dÉ™ olan xam verilÉ™nlÉ™ri, o cÃ¼mlÉ™dÉ™n ÅŸifrÉ™lÉ™nmiÅŸ verilÉ™nlÉ™ri sorÄŸulaya bilÉ™rik.

Athena sorÄŸularÄ±n performansÄ±nÄ± vÉ™ sÃ¼rÉ™tini daha É™lveriÅŸli etmÉ™k Ã¼Ã§Ã¼n Parquet sÃ¼tunlu fayl formatÄ±nÄ± dÉ™stÉ™klÉ™yir. Parquet formatÄ±nda olan data Ã¼zÉ™rindÉ™ sorgular daha sÃ¼rÉ™tli nÉ™ticÉ™ gÃ¶stÉ™rir.

_Athena, bÃ¶yÃ¼k verilÉ™nlÉ™r bazalarÄ±nda sÃ¼rÉ™tlÉ™ iÅŸlÉ™yÉ™n open-source vÉ™ distributed SQL sorÄŸu mÃ¼hÉ™rriki_ [_Presto_](https://prestodb.io/)_-ya É™saslanÄ±r._

Biz Athena-ya AWS Management Console, API, Open Dataâ€ base Connectivity (ODBC) vÉ™ ya Java Database Connectivity (JDBC) driver vasitÉ™silÉ™ daxil ola bilÉ™rik. Bu tutorialÄ±n É™vvÉ™lindÉ™ yaratdÄ±ÄŸÄ±mÄ±z useri istifadÉ™ edÉ™rÉ™k, consoledan daxil olaq.

![](https://miro.medium.com/max/875/1*oHgBeV4iJ4a8LdUv7lWIqQ.png)

SÉ™hifÉ™dÉ™n  [**Explore the query editor**](https://us-east-1.console.aws.amazon.com/athena/home?region=us-east-1#)  Ã¼zÉ™rinÉ™ kliklÉ™yin. Yeni aÃ§Ä±lan sÉ™hifÉ™dÉ™ ilk olaraq sorÄŸu nÉ™ticÉ™lÉ™rimizin hansÄ± s3 bucketÉ™ yazÄ±lacaÄŸÄ±nÄ± mÃ¼É™yyÉ™nlÉ™ÅŸdirmÉ™liyik. Bunun Ã¼Ã§Ã¼n  **Settings > Manage > Browse S3** seÃ§imini edÉ™rÉ™k, nÉ™ticÉ™lÉ™ri hansÄ± s3 bucketÉ™ yazmaq istÉ™yirsinizsÉ™ onu qeyd edirsiniz.

![](https://miro.medium.com/max/875/1*_0XCuptu8_LVGP33HF8UsQ.png)

Oley! ğŸ‰

Ä°ndi sorÄŸularÄ±mÄ±zÄ± yaza bilÉ™rik! Ä°lk olaraq, aÃ§Ä±lan sql pÉ™ncÉ™rÉ™sindÉ™ SQL komandasÄ±ndan istifadÉ™ edÉ™rÉ™k, yeni database yaratmalÄ±yÄ±q. Bunun Ã¼Ã§Ã¼n

CREATE DATABASE mehsullar

![](https://miro.medium.com/max/875/1*DPI7zjjjZX8t-GDMm6E0QQ.png)

Ä°ndi isÉ™ sÄ±ra gÉ™ldi, mÉ™hsullar Ã¼zÉ™rindÉ™ sorÄŸular yaza bilmÉ™yimiz Ã¼Ã§Ã¼n table yaratmaÄŸa. Bunun Ã¼Ã§Ã¼n yeni sorÄŸu pÉ™ncÉ™rÉ™si aÃ§Ä±b, aÅŸaÄŸÄ±dakÄ± sorÄŸunu daxil edin.

CREATE EXTERNAL TABLE IF NOT EXISTS mehsullar.satis_mehsullar_2019(  
    id int,  
        satish_kodu int,mehsul_kodu int,  
          
        mehsul_ad string,  
          
        mehsul_kateqoriya string,  
          
        mehsul_qiymet int,  
          
        satish_tarixi string,  
          
        endirim_kompaniya string,  
          
        bonus_kart string,  
          
        magaza_ad string,  
          
        magaza_lat float,  
          
        magaza_long float  
          
    )   
ROW FORMAT SERDE 'org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe'  
WITH SERDEPROPERTIES (  
 'serialization.format' = ',',  
 'field.delim' = ','  
)  
LOCATION 's3://ssupermarket-dataset/'  
TBLPROPERTIES ('skip.header.line.count'='1')

![](https://miro.medium.com/max/875/1*xvjV3g_KvR24uKB0uKioBA.png)

Æla! cÉ™dvÉ™limiz yarandÄ±! HÉ™r ÅŸeyin dÃ¼zgÃ¼n iÅŸlÉ™diyini yoxlamaq Ã¼Ã§Ã¼n belÉ™ bir nÃ¼munÉ™ sorÄŸu yazaq:

select * from mehsullar.satis_mehsullar_2019 where mehsul_qiymet> 2

![](https://miro.medium.com/max/875/1*VFf9RBIJNxB-KUz9Oju4fA.png)

## HÉ™r ÅŸey hazÄ±r! ğŸŠğŸ‰

ÆgÉ™r diqqÉ™t etdinizsÉ™, yuxarÄ±dakÄ± sorÄŸunun nÉ™ticÉ™si 1.869 saniyÉ™yÉ™ hazÄ±r oldu vÉ™ Ã¼mumilikdÉ™ 57.70 mb data skan olundu. BÉ™s, bunu daha sÃ¼rÉ™tli edÉ™ bilÉ™rik mi? YazÄ±nÄ±n É™vvÉ™lindÉ™ dÉ™ qeyd etdiyimiz kimi, Athena parquet formartÄ±nda olan data ilÉ™ daha sÃ¼rÉ™tli iÅŸlÉ™yir. Bunun sÉ™bÉ™binÉ™ nÃ¶vbÉ™ti mÉ™qalÉ™dÉ™ toxunacam, lakin indi table yaradarkÉ™n onu necÉ™ parquet formatÄ±na Ã§evirÉ™ bilÉ™rik, buna baxaq.

VÉ™ É™n É™sasÄ±, gÃ¶rÉ™k doÄŸrudan da mÄ± parquet formatÄ±nda olan data daha sÃ¼rÉ™tli oxunur.

Bunun Ã¼Ã§Ã¼n yenidÉ™n Athena servisinin É™sas sÉ™hifÉ™sinÉ™ qayÄ±dÄ±rÄ±q. Database olaraq mehsullar seÃ§ildiyindÉ™n É™min oluruq vÉ™  **Tables and views > Create with SQL > Create table**  ardÄ±cÄ±llÄ±ÄŸÄ±nÄ± hÉ™yata keÃ§iririk.

![](https://miro.medium.com/max/875/1*0ieMU_8APfBPbZpcjDoffQ.png)

AÃ§Ä±lan yeni SQL sorÄŸu pÉ™ncÉ™rÉ™sinÉ™ aÅŸaÄŸÄ±dakÄ± sorÄŸunu daxil edin.

CREATE TABLE IF NOT EXISTS mehsullar.satis_mehsullar_2019_parquet  
    WITH (format = 'PARQUET', external_location = 's3://ssupermarket-dataset/parquet') AS  
              
    select   
    *   
    FROM mehsullar.satis_mehsullar_2019

Tables bÃ¶lmÉ™sinÉ™ baxdÄ±qda yeni yaranmÄ±ÅŸ satis_mehsullar_2019_parquet cÉ™dvÉ™lini gÃ¶rÉ™ bilÉ™rik. Ä°ndi isÉ™ bayaqki sorÄŸunu yenidÉ™n bu cÉ™dvÉ™l Ã¼zÉ™rindÉ™ yoxlayaq vÉ™ nÉ™ticÉ™lÉ™ri mÃ¼qayisÉ™ edÉ™k.

![](https://miro.medium.com/max/875/1*V88DgNs1WbkJGV9uQAsCWA.png)

Eyni sorÄŸu, eyni data Ã¼zÉ™rindÉ™ :)  **Runtime 1.869 saniyÉ™dÉ™n 1.709 saniyÉ™yÉ™, skan olunan data isÉ™ 57.70 mbdan 9.51 mbya qÉ™dÉ™r azaldÄ±.**  Biz partitionlar verÉ™rÉ™k, aradakÄ± fÉ™rqi daha da artÄ±ra bilÉ™rik.

Bu mÉ™qalÉ™dÉ™, aws cli istifadÉ™ edÉ™rÉ™k lokal kompÃ¼terimizdÉ™ olan datanÄ± s3 bucketinÉ™ yÃ¼klÉ™mÉ™yi vÉ™ athena ilÉ™ o data Ã¼zÉ™rindÉ™ sorÄŸular yazmaÄŸÄ± Ã¶yrÉ™ndik. Daha sonra isÉ™, dataseti csv\tsv formatÄ± ilÉ™ mÃ¼qayisÉ™dÉ™ daha sÃ¼rÉ™tli olan parquet formatÄ±na Ã§evirÉ™rÉ™k, nÉ™ticÉ™lÉ™ri mÃ¼qayisÉ™ etdik.

GÃ¶rÃ¼ÅŸÉ™nÉ™dÉ™k!

